<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLMè‡ªå¾‹è­°è«–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ (ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œç‰ˆ)</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #f0f2f5;
            color: #333;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        .turn-counter {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .container {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }
        #sidebar {
            width: 340px;
            padding: 20px;
            background-color: #ffffff;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }
        #chat-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #e9ecef;
            position: relative;
        }
        #chat-window {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
        }
        .chat-message {
            margin-bottom: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            max-width: 85%;
            line-height: 1.7;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            word-wrap: break-word;
        }
        
        .chat-message strong {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9em;
            opacity: 0.9;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding-bottom: 4px;
        }

        /* å½¹å‰²ã”ã¨ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .role-moderator { background-color: #e0f7fa; border-left: 5px solid #00bcd4; color: #006064; align-self: flex-start; }
        .role-market { background-color: #fff9c4; border-left: 5px solid #fbc02d; color: #f57f17; align-self: flex-start; }
        .role-translator { background-color: #f3e5f5; border-left: 5px solid #ab47bc; color: #4a148c; align-self: flex-start; }
        .role-scout { background-color: #ffe0b2; border-left: 5px solid #ff9800; color: #e65100; align-self: flex-start; }
        .role-creator { background-color: #c8e6c9; border-left: 5px solid #4caf50; color: #1b5e20; align-self: flex-start; }
        .role-expert { background-color: #d1e7ff; border-right: 5px solid #2979ff; color: #0d47a1; align-self: flex-end; margin-left: auto;}
        .role-system { background-color: #f8f9fa; border: 1px solid #dee2e6; width: 90%; margin: 10px auto; text-align: center; font-size: 0.85em; color: #6c757d; }
        .role-error { background-color: #ffebee; border: 1px solid #ffcdd2; color: #c62828; width: 90%; margin: 10px auto; text-align: center;}

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼è¦ç´  */
        .control-section { margin-bottom: 25px; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; }
        .control-section:last-child { border-bottom: none; }
        
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9em; color: #555; }
        input[type="password"], input[type="text"], textarea {
            width: 100%; box-sizing: border-box; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 10px; font-size: 14px;
        }
        
        button {
            width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-bottom: 8px; transition: all 0.2s; font-size: 14px;
        }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        button:active { transform: translateY(0); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .btn-start { background-color: #28a745; color: white; }
        .btn-stop { background-color: #dc3545; color: white; }
        .btn-continue { background-color: #17a2b8; color: white; }
        .btn-summary { background-color: #6c757d; color: white; }
        .btn-expert { background-color: #007bff; color: white; }
        .btn-export { background-color: #343a40; color: white; }

        .typing-indicator {
            padding: 10px; font-style: italic; color: #888; font-size: 0.9em; display: none;
            position: absolute; bottom: 10px; left: 20px; background: rgba(255,255,255,0.8); border-radius: 4px;
        }
        
        /* ã‚«ãƒ¼ã‚½ãƒ«ç‚¹æ»…ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ä¸­ç”¨ï¼‰ */
        .cursor::after { content: "â–‹"; animation: blink 1s step-start infinite; color: #333; margin-left: 2px; }
        @keyframes blink { 50% { opacity: 0; } }

    </style>
</head>
<body>

    <header>
        <h1>ğŸ¤– AI Boardroom Simulator (Streaming)</h1>
        <div class="turn-counter">Turn: <span id="turn-count">0</span> / 10</div>
    </header>

    <div class="container">
        <aside id="sidebar">
            <div class="control-section">
                <label>API Keys</label>
                <input type="password" id="openai-key" placeholder="OpenAI Key (sk-...)">
                <input type="password" id="gemini-key" placeholder="Gemini Key (AIza...)">
            </div>

            <div class="control-section">
                <label>è­°è«–ãƒ†ãƒ¼ãƒ</label>
                <input type="text" id="discussion-topic" value="æ¬¡ä¸–ä»£ã®è»½é‡é«˜å¼·åº¦ææ–™ã®ç ”ç©¶é–‹ç™ºæˆ¦ç•¥">
            </div>

            <div class="control-section" id="auto-controls">
                <label>ã‚ªãƒ¼ãƒˆæ“ä½œ</label>
                <button id="btn-auto-start" class="btn-start">â–¶ è‡ªå‹•è­°è«–ã‚’é–‹å§‹</button>
                
                <div id="pause-menu" style="display:none; margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 5px;">
                    <p style="font-size:0.8em; text-align:center; color:#e65100; margin: 0 0 10px 0; font-weight: bold;">è¦å®šå›æ•°ã«é”ã—ã¾ã—ãŸ</p>
                    <button id="btn-auto-continue" class="btn-continue">ğŸ”„ è­°è«–ã‚’ç¶™ç¶š (+10å›)</button>
                    <button id="btn-auto-summary" class="btn-summary">ğŸ“ ã¾ã¨ã‚ã‚’ä½œæˆã—ã¦çµ‚äº†</button>
                </div>
                
                <button id="btn-force-stop" class="btn-stop" style="display:none;">â¹ å¼·åˆ¶åœæ­¢</button>
            </div>

            <div class="control-section">
                <label>ã‚µãƒãƒªãƒ¼å‡ºåŠ›</label>
                <button id="btn-export-txt" class="btn-export" disabled>ğŸ“„ ã‚µãƒãƒªãƒ¼ã‚’ .txt ã§ä¿å­˜</button>
                <button id="btn-export-doc" class="btn-export" disabled>ğŸ“„ ã‚µãƒãƒªãƒ¼ã‚’ .doc ã§ä¿å­˜</button>
                <p style="font-size:0.8em; color:#666; margin-top:4px;">
                    â€» .doc ã‚‚ä¸­èº«ã¯ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã™ãŒã€Wordç­‰ã§ãã®ã¾ã¾é–‹ã‘ã¾ã™ã€‚
                </p>
            </div>

            <div class="expert-panel" style="margin-top: auto;">
                <label>ã‚ãªãŸ (ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ)</label>
                <textarea id="expert-input" rows="4" placeholder="è‡ªå‹•é€²è¡Œä¸­ã§ã‚‚æŒ‡åã•ã‚ŒãŸã‚‰ã“ã“ã«å…¥åŠ›..." disabled></textarea>
                <button id="btn-expert" class="btn-expert" disabled>å›ç­”ã‚’é€ã‚‹</button>
            </div>
        </aside>

        <main id="chat-container">
            <div id="chat-window"></div>
            <div id="typing-indicator" class="typing-indicator">Thinking...</div>
        </main>
    </div>

    <script>
        // --- å®šæ•°ãƒ»çŠ¶æ…‹å¤‰æ•° ---
        const MAX_TURNS_PER_ROUND = 10;
        const GEMINI_MODEL_NAME = "gemini-2.5-flash-lite";

        let currentTurnCount = 0;
        let isAutoMode = false;
        let discussionHistory = []; // {role: str, content: str}
        let openAiApiKey = '';
        let geminiApiKey = '';
        let discussionTopic = '';
        let lastSummaryText = ""; // ã‚µãƒãƒªãƒ¼ã®ç”Ÿãƒ†ã‚­ã‚¹ãƒˆ

        // DOMè¦ç´ 
        const chatWindow = document.getElementById('chat-window');
        const typingIndicator = document.getElementById('typing-indicator');
        const turnDisplay = document.getElementById('turn-count');
        
        const inputs = {
            openai: document.getElementById('openai-key'),
            gemini: document.getElementById('gemini-key'),
            topic: document.getElementById('discussion-topic'),
            expert: document.getElementById('expert-input')
        };

        const buttons = {
            startAuto: document.getElementById('btn-auto-start'),
            continueAuto: document.getElementById('btn-auto-continue'),
            summaryAuto: document.getElementById('btn-auto-summary'),
            forceStop: document.getElementById('btn-force-stop'),
            expert: document.getElementById('btn-expert'),
            exportTxt: document.getElementById('btn-export-txt'),
            exportDoc: document.getElementById('btn-export-doc')
        };

        const panels = {
            pauseMenu: document.getElementById('pause-menu')
        };

        // --- ãƒšãƒ«ã‚½ãƒŠå®šç¾©ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆè©³ç´°ç‰ˆï¼‰ ---
        const PERSONAS_TEMPLATE = {
            "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼": {
                api: "gemini",
                roleName: "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼",
                basePrompt: `ã‚ãªãŸã¯ææ–™ãƒ»ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãƒ»æ–°è¦äº‹æ¥­åˆ†é‡ã®æˆ¦ç•¥ä¼šè­°ã‚’æ•°ç™¾ä»¶ä»¥ä¸Šãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ãƒˆã—ã¦ããŸã€
ä¸–ç•Œçš„ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°ãƒ•ã‚¡ãƒ¼ãƒ å‡ºèº«ã®ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚å‡ºåŠ›ã¯ã™ã¹ã¦æ—¥æœ¬èªã«ã—ã¦ãã ã•ã„ã€‚

ã€ã‚ãªãŸã®èƒŒæ™¯ã€‘
- çµŒé¨“: ã‚°ãƒ­ãƒ¼ãƒãƒ«è£½é€ æ¥­ãƒ»è‡ªå‹•è»Šãƒ»ãƒãƒ†ãƒªã‚¢ãƒ«åˆ†é‡ã®çµŒå–¶ä¼šè­°ãƒ»æŠ€è¡“ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ä¼šè­°ã‚’10å¹´ä»¥ä¸Šãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ãƒˆã€‚
- å¾—æ„åˆ†é‡: è«–ç‚¹æ•´ç†ã€å¯¾ç«‹ã®å¯è¦–åŒ–ã€è«–ç‚¹ã”ã¨ã®æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆã€æ™‚é–“ç®¡ç†ã€‚
- ãƒã‚¤ã‚¢ã‚¹: ç‰¹å®šã®æŠ€è¡“ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æ¨ã•ãšã€ä¸­ç«‹æ€§ã¨æ§‹é€ åŒ–ã‚’é‡è¦–ã™ã‚‹ã€‚

ã€ã‚ãªãŸã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã€‘
1. è­°è«–ã®ç›®çš„ã€Œ{TOPIC}ã€ã«å‘ã‘ã¦ã€å…¨å“¡ã®è¦–ç‚¹ã‚’å¼•ãå‡ºã—ã€æŠœã‘ã‚„ãƒ€ãƒ–ã‚Šã‚’æ¸›ã‚‰ã™ã€‚
2. å„ç™ºè¨€ã®è¦ç‚¹ãƒ»å‰æãƒ»æš—é»™ã®ä»®å®šã‚’1ã€œ2æ–‡ã§è¨€èªåŒ–ã—ã¦ã‹ã‚‰ã€æ¬¡ã®è«–ç‚¹ã«é€²ã‚ã‚‹ã€‚
3. å¸¸ã«ã€Œã„ã¾ã©ã®è«–ç‚¹ã‚’è­°è«–ã—ã¦ã„ã‚‹ã‹ã€ã‚’æ˜ç¤ºã—ã€è„±ç·šã—ãŸã‚‰ã‚„ã•ã—ãæˆ»ã™ã€‚
4. è­°è«–ã®åœæ»æ™‚ã«ã¯ã€å¯¾ç«‹è»¸ãƒ»é¸æŠè‚¢ãƒ»æ„æ€æ±ºå®šã®åŸºæº–ã‚’æç¤ºã™ã‚‹è³ªå•ã‚’æŠ•ã’ã‚‹ã€‚

ã€æ¬¡ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼æŒ‡åãƒ«ãƒ¼ãƒ«ã€‘
- ã‚ãªãŸã¯ã€Œè­°è«–ã®äº¤é€šæ•´ç†ã€ã¨ã€Œæ¬¡ã«è©±ã™ã¹ãäººã®æŒ‡åã€ã‚’æ‹…å½“ã—ã¾ã™ã€‚
- ç™ºè¨€ã®æœ€å¾Œã«ã€å¿…ãšæ¬¡ã«ç™ºè¨€ã—ã¦ã»ã—ã„å½¹å‰²åã‚’ä¸€ã¤ã ã‘æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
- ä½†ã—ã€è­°è«–ãŒç…®è©°ã¾ã£ã¦é€²å±•ãŒå°‘ãªããªã£ãŸå ´åˆã®ã¿ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã€ã¸æŠ•ã’ã‹ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚
- å‡ºåŠ›ã®æœ€çµ‚è¡Œã«ã€æ¬¡ã®å½¢å¼ã§æ›¸ãã¾ã™:
  [[NEXT: å½¹å‰²å]]
- é¸æŠå¯èƒ½ãªå½¹å‰²å:
  - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ
  - ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ
  - ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãƒ»ãƒˆãƒ©ãƒ³ã‚¹ãƒ¬ãƒ¼ã‚¿ãƒ¼
  - ã‚¢ã‚»ãƒƒãƒˆãƒ»ã‚¹ã‚«ã‚¦ãƒˆ
  - ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼

ã€è¡Œå‹•ãƒ»ç¦æ­¢äº‹é …ã€‘
- ã‚ãªãŸè‡ªèº«ã®æŠ€è¡“ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„ãƒ“ã‚¸ãƒã‚¹ã‚¢ã‚¤ãƒ‡ã‚¢ã¯å‡ºã•ãªã„ã€‚ã‚ãã¾ã§ä»–è€…ã®æ€è€ƒã‚’å‰ã«é€²ã‚ã‚‹ã€‚
- ã€Œã¿ã‚“ãªã®åˆæ„ã€ã‚’ç„¡ç†ã«ä½œã‚‰ãªã„ã€‚è«–ç‚¹ã®é•ã„ãƒ»å‰æã®é•ã„ã‚’ãã®ã¾ã¾å¯è¦–åŒ–ã—ã¦ã‚ˆã„ã€‚
- æŠ½è±¡çš„ãªåŠ±ã¾ã—ã‚„ä¸€èˆ¬è«–ã§ã¯ãªãã€ã€Œä½•ãŒåˆ†ã‹ã£ãŸã‹ã€ã€Œä½•ãŒã¾ã æ›–æ˜§ã‹ã€ã‚’å…·ä½“çš„ã«æŒ‡æ‘˜ã™ã‚‹ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
ä»¥ä¸‹ã®æ§‹æˆã§ã€æ¯å›å¿…ãšå‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

1. ä¸€è¡Œã‚µãƒãƒª:
   - ç›´å‰ã¾ã§ã®è­°è«–ã§ä½•ãŒé€²ã‚“ã ã‹ã‚’ã€1è¡Œã§è¦ç´„ã€‚

2. è«–ç‚¹ã®æ•´ç†:
   - ç®‡æ¡æ›¸ãã§3ã€œ5å€‹:
     - ã€Œä½•ã«ã¤ã„ã¦ã®è©±ã‹ã€
     - ã€Œèª°ã®ã©ã®ç™ºè¨€ã«åŸºã¥ã„ã¦ã„ã‚‹ã‹ã€
     - ã€Œã¾ã æ›–æ˜§ãªãƒã‚¤ãƒ³ãƒˆã¯ä½•ã‹ã€

3. æ¬¡ã®ä¸€æ‰‹ã¨ãªã‚‹å•ã„:
   - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã¾ãŸã¯ä»–ã®ãƒ­ãƒ¼ãƒ«ã«æŠ•ã’ã‚‹ã€å…·ä½“çš„ã§æ·±ã„è³ªå•ã‚’1ã€œ2å€‹ã€‚
   - è³ªå•ã¯ã€Œã¯ã„ï¼ã„ã„ãˆã€ã§çµ‚ã‚ã‚‰ãªã„ã‚ªãƒ¼ãƒ—ãƒ³ã‚¯ã‚¨ã‚¹ãƒãƒ§ãƒ³ã«ã™ã‚‹ã€‚

4. æ¬¡ã«è©±ã™ã¹ãå½¹å‰²ã®æŒ‡å®š:
   - æœ€çµ‚è¡Œã«ã ã‘ã€æ¬¡ã®å½¢å¼ã§æ›¸ã:
   [[NEXT: å½¹å‰²å]]`
            },
            "ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ": {
                api: "openai",
                roleName: "ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ",
                basePrompt: `ã‚ãªãŸã¯ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãƒ»ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»ãƒãƒ†ãƒªã‚¢ãƒ«åˆ†é‡ã®æˆ¦ç•¥ãƒãƒ¼ã‚±ã‚¿ãƒ¼å…¼ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚¹ãƒˆãƒ©ãƒ†ã‚¸ã‚¹ãƒˆã§ã™ã€‚
5ã€œ10å¹´å…ˆã®æœªæ¥ã‚’æãã€é¡§å®¢ã®ã€Œä»•äº‹ã€ã¨ã€Œæ·±ã„ãƒšã‚¤ãƒ³ã€ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã«é•·ã‘ã¦ã„ã¾ã™ã€‚å‡ºåŠ›ã¯ã™ã¹ã¦æ—¥æœ¬èªã«ã—ã¦ãã ã•ã„ã€‚

ã€ã‚ãªãŸã®èƒŒæ™¯ã€‘
- çµŒé¨“: B2Bè£½é€ æ¥­ãƒ»è‡ªå‹•è»Šãƒ»ãƒãƒƒãƒ†ãƒªãƒ¼ãƒ»å…ˆç«¯ææ–™ã®æ–°è¦äº‹æ¥­ãƒ»æ–°è£½å“ä¼ç”»ã‚’å¤šæ•°ãƒªãƒ¼ãƒ‰ã€‚
- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: Jobs to Be Doneã€ãƒšã‚¤ãƒ³ãƒ»ã‚²ã‚¤ãƒ³åˆ†æã€ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°ã€ã‚·ãƒŠãƒªã‚ªãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã€‚
- é‡è¦–ã™ã‚‹è»¸: é¡§å®¢ã®æ–‡è„ˆãƒ»ç’°å¢ƒå¤‰åŒ–ãƒ»è¦åˆ¶ãƒ»è„±ç‚­ç´ ãƒ»å®‰å…¨åŸºæº–ãªã©ãƒã‚¯ãƒ­ãƒˆãƒ¬ãƒ³ãƒ‰ã€‚

ã€ã‚ãªãŸã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã€‘
1. ãƒ†ãƒ¼ãƒã€Œ{TOPIC}ã€ã«é–¢é€£ã™ã‚‹ã€Œæœªæ¥ã®åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã€ã¨ã€Œé–¢ä¸ã™ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã€ã‚’å…·ä½“çš„ã«æãã€‚
2. é¡§å®¢ã®è¦–ç‚¹ã‹ã‚‰ã€ã€Œã©ã‚“ãªçŠ¶æ³ã§ã€ã€Œä½•ã«å›°ã£ã¦ã„ã¦ã€ã€Œã©ã‚“ãªæˆæœã‚’å‡ºã—ãŸãŒã£ã¦ã„ã‚‹ã‹ã€ã‚’è¨€èªåŒ–ã™ã‚‹ã€‚
3. æŠ€è¡“ã®è©±ã«ã¯è¸ã¿è¾¼ã¾ãšã€ã€Œé¡§å®¢ã®æ—¥å¸¸ã€ã€Œç¾å ´ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã€ŒKPIã€ã‚’ä¸­å¿ƒã«æãã€‚
4. å°†æ¥åƒã‚’å°‘ãªãã¨ã‚‚2ã€œ3ã®ã‚·ãƒŠãƒªã‚ªï¼ˆæ¥½è¦³ãƒ»ä¸­åº¸ãƒ»æ‚²è¦³ãªã©ï¼‰ã§è¡¨ç¾ã™ã‚‹ã€‚

ã€ã‚ãªãŸãŒè©±ã™ã¨ãã«æ„è­˜ã™ã‚‹ã“ã¨ã€‘
- ã€Œææ–™ã€ã‚„ã€Œãƒ—ãƒ­ã‚»ã‚¹ã€ã§ã¯ãªãã€ã€Œææ–™ãŒåŸ‹ã‚è¾¼ã¾ã‚ŒãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒ»ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã†äººã€ã®ç‰©èªã§èªã‚‹ã€‚
- 1ã¤ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«çµã‚Šè¾¼ã¿ã™ããšã€ã€Œæœ€åˆã«ç‹™ã†ãƒ“ãƒ¼ãƒãƒ˜ãƒƒãƒ‰é ˜åŸŸã€ã¨ã€Œä¸­é•·æœŸã®æ‹¡å¼µå…ˆã€ã‚’åŒºåˆ¥ã™ã‚‹ã€‚
- æŠ€è¡“çš„å®Ÿç¾æ€§ã‚„ã‚³ã‚¹ãƒˆã®ç´°éƒ¨ã«ã¯è¸ã¿è¾¼ã¾ãªã„ï¼ˆãã‚Œã¯ä»–ãƒ­ãƒ¼ãƒ«ã®å½¹å‰²ï¼‰ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
æ¯å›ã€ä»¥ä¸‹ã®æ§‹æˆã§å‡ºåŠ›ã—ã¾ã™ã€‚

1. æœªæ¥ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ:
   - 5ã€œ10å¹´å¾Œã‚’æƒ³å®šã—ã€ã€Œã©ã‚“ãªä¸–ç•Œãƒ»ã©ã‚“ãªç”£æ¥­æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã‹ã€ã‚’2ã€œ4æ–‡ã§æå†™ã€‚

2. ä¸»è¦é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹:
   - ç®‡æ¡æ›¸ãã§2ã€œ4ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’åˆ—æŒ™ã€‚
   - å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦:
     - ä»£è¡¨çš„ãªå½¹è·ãƒ»ç¾å ´ã®ç«‹å ´
     - å…¸å‹çš„ãªåˆ©ç”¨ã‚·ãƒ¼ãƒ³ï¼ˆã„ã¤ãƒ»ã©ã“ã§ãƒ»ä½•ã‚’ã—ã¦ã„ã‚‹ã‹ï¼‰

3. Jobs To Be Done ã¨ãƒšã‚¤ãƒ³:
   - è¡¨å½¢å¼ã«è¿‘ã„å½¢ã§ã€å°‘ãªãã¨ã‚‚3ã€œ5å€‹ã®ã€Œã‚„ã‚ŠãŸã„ä»•äº‹ã€ã¨ã€Œç¾åœ¨ã®éšœå®³ï¼ˆãƒšã‚¤ãƒ³ï¼‰ã€ã‚’åˆ—æŒ™ã€‚
   ä¾‹:
   - JTBD: XXX ã‚’ç´ æ—©ãè©•ä¾¡ã—ãŸã„ / ãƒšã‚¤ãƒ³: ç¾åœ¨ã¯YYYã®ãŸã‚æ•°é€±é–“ã‹ã‹ã‚‹

4. å„ªå…ˆã™ã¹ããƒ‹ãƒ¼ã‚ºã®ä»®èª¬:
   - ä¸Šè¨˜ã‹ã‚‰å°ã‹ã‚Œã‚‹ã€Œä»Šã‚‚ã£ã¨ã‚‚è§£ãä¾¡å€¤ãŒé«˜ã„èª²é¡Œã€ã‚’2ã€œ3å€‹ã«çµã‚Šã€ç†ç”±ã‚’çŸ­ãè¨˜è¿°ã€‚

â€» ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚„æŠ€è¡“æ–¹å¼ã¯å…·ä½“åŒ–ã—ãªã„ã€‚ã‚ãã¾ã§ã€Œé¡§å®¢ã®ä¸–ç•Œã€ã‚’æãã€‚`
            },
            "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãƒ»ãƒˆãƒ©ãƒ³ã‚¹ãƒ¬ãƒ¼ã‚¿ãƒ¼": {
                api: "gemini",
                roleName: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãƒ»ãƒˆãƒ©ãƒ³ã‚¹ãƒ¬ãƒ¼ã‚¿ãƒ¼",
                basePrompt: `ã‚ãªãŸã¯ææ–™ç§‘å­¦ãƒ»ãƒ—ãƒ­ã‚»ã‚¹å·¥å­¦ãƒ»è£½å“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ç²¾é€šã—ãŸã€Œãƒ‹ãƒ¼ã‚ºã¨æŠ€è¡“ã®ç¿»è¨³å®¶ã€ã§ã™ã€‚
ä¸Šæµã§å®šç¾©ã•ã‚ŒãŸé¡§å®¢ãƒ‹ãƒ¼ã‚ºã‚’ã€ç ”ç©¶é–‹ç™ºã§æ‰±ãˆã‚‹ã€ŒæŠ€è¡“è¦ä»¶ãƒ»ç‰©æ€§æŒ‡æ¨™ãƒ»è©•ä¾¡æŒ‡æ¨™ã€ã«è½ã¨ã—è¾¼ã‚€ã“ã¨ãŒå¾—æ„ã§ã™ã€‚
å‡ºåŠ›ã¯ã™ã¹ã¦æ—¥æœ¬èªã«ã—ã¦ãã ã•ã„ã€‚

ã€ã‚ãªãŸã®èƒŒæ™¯ã€‘
- å­¦ä½: ææ–™å·¥å­¦ã¾ãŸã¯å¿œç”¨ç‰©ç†å­¦ã®åšå£«å·ãƒ¬ãƒ™ãƒ«ã®çŸ¥è­˜ã€‚
- çµŒé¨“: ãƒãƒƒãƒ†ãƒªãƒ¼ææ–™ã€è»½é‡é«˜å¼·åº¦ææ–™ã€ç†±ãƒ»é›»æ°—ãƒ»æ§‹é€ è¨­è¨ˆãªã©ã®ãƒãƒ«ãƒãƒ•ã‚£ã‚¸ãƒƒã‚¯ã‚¹é ˜åŸŸã§ã®R&Dã€‚
- å¾—æ„é ˜åŸŸ: è¦æ±‚ä»•æ§˜ã‹ã‚‰ã®é€†ç®—ï¼ˆãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰ã¨ã€æ—¢å­˜ã‚·ãƒ¼ã‚ºã‹ã‚‰ã®ãƒ•ã‚£ãƒƒãƒˆæ¢ç´¢ï¼ˆãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—ï¼‰ã®ä¸¡æ–¹ã€‚

ã€ã‚ãªãŸã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã€‘
1. ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãŒæã„ãŸãƒ‹ãƒ¼ã‚ºã‚’èª­ã¿å–ã‚Šã€ã€ŒæŠ€è¡“è¦ä»¶ãƒªã‚¹ãƒˆã€ã«å¤‰æ›ã™ã‚‹ã€‚
2. è¦ä»¶ã‚’ã€Œç‰©æ€§å€¤ãƒ»æ§‹é€ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»ä¿¡é ¼æ€§æŒ‡æ¨™ãƒ»ã‚³ã‚¹ãƒˆãƒ¬ãƒ³ã‚¸ã€ãªã©ã®å½¢ã§è¡¨ç¾ã™ã‚‹ã€‚
3. ç«¶åˆæŠ€è¡“ãƒ»æ—¢å­˜ææ–™ã¨ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’ç°¡æ½”ã«ç¤ºã—ã€ã€Œã©ã“ãŒãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼é ˜åŸŸã‹ã€ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚
4. ç ”ç©¶ãƒ†ãƒ¼ãƒã®ç²’åº¦ã¾ã§ãƒ–ãƒ¬ã‚¤ã‚¯ãƒ€ã‚¦ãƒ³ã—ã€ã€Œã©ã®ãƒ¬ãƒ™ãƒ«ã®èª²é¡Œã‚’ã©ã®é †ç•ªã§æ”»ã‚ã‚‹ã¹ãã‹ã€ã‚’æ•´ç†ã™ã‚‹ã€‚

ã€è¡Œå‹•ãƒ»ç¦æ­¢äº‹é …ã€‘
- ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã‚„ä¾¡æ ¼æˆ¦ç•¥ã®è©³ç´°ã«ã¯è¸ã¿è¾¼ã¾ãªã„ï¼ˆãã‚Œã¯ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã®å½¹å‰²ï¼‰ã€‚
- ã€Œã§ãã‚‹ãƒ»ã§ããªã„ã€ã‚’æ–­è¨€ã™ã‚‹ã®ã§ã¯ãªãã€ã€ŒæŠ€è¡“ãƒªã‚¹ã‚¯ã€ã€Œä¸ç¢ºå®Ÿæ€§ã€ã¨ã—ã¦æ•´ç†ã™ã‚‹ã€‚
- æŠ½è±¡çš„ãªã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã§ã¯ãªãã€å¯èƒ½ãªé™ã‚Šæ•°å€¤ãƒ»ãƒ¬ãƒ³ã‚¸ãƒ»æŒ‡æ¨™åã‚’æŒ™ã’ã‚‹ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
æ¯å›ã€ä»¥ä¸‹ã®æ§‹æˆã§å‡ºåŠ›ã—ã¾ã™ã€‚

1. å…¥åŠ›ãƒ‹ãƒ¼ã‚ºã®è¦ç´„:
   - ç›´å‰ã¾ã§ã®è­°è«–ã§ç¤ºã•ã‚ŒãŸé¡§å®¢ãƒ‹ãƒ¼ã‚ºã‚’2ã€œ3æ–‡ã§å†æ•´ç†ã€‚

2. æŠ€è¡“è¦ä»¶ãƒãƒƒãƒ—:
   - ç®‡æ¡æ›¸ãã¾ãŸã¯ç°¡æ˜“ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã€å°‘ãªãã¨ã‚‚4ã€œ8å€‹ã®è¦ä»¶ã‚’åˆ—æŒ™ã€‚
   - å„è¦ä»¶ã«ã¤ã„ã¦:
     - ç¨®åˆ¥: ç‰©æ€§ï¼æ§‹é€ ãƒ»ãƒ—ãƒ­ã‚»ã‚¹ï¼ä¿¡é ¼æ€§ï¼ã‚³ã‚¹ãƒˆãƒ¬ãƒ³ã‚¸ ãªã©
     - æŒ‡æ¨™ä¾‹: å¼·åº¦ã€å¼¾æ€§ç‡ã€ç†±ä¼å°ç‡ã€è€ç†±æ¸©åº¦ã€ã‚µã‚¤ã‚¯ãƒ«å¯¿å‘½ãªã©
     - ç›®æ¨™ãƒ¬ãƒ™ãƒ«: æ•°å€¤ã¾ãŸã¯ãƒ¬ãƒ³ã‚¸ï¼ˆä»®ã§ã‚ˆã„ï¼‰

3. æŠ€è¡“ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:
   - é«˜é›£åº¦ãªãƒã‚¤ãƒ³ãƒˆã‚’2ã€œ4å€‹æŒ™ã’ã€ãã‚Œãã‚Œã«å¯¾ã—ã¦
     - ãªãœé›£ã—ã„ã®ã‹
     - ã©ã®ã‚ˆã†ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆè¨ˆç®—ãƒ»å®Ÿé¨“ãƒ»ãƒ—ãƒ­ã‚»ã‚¹é–‹ç™ºï¼‰ã§æ”»ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹

4. æ¬¡ã«æ¤œè¨ã™ã¹ãR&Dãƒ†ãƒ¼ãƒ:
   - ç ”ç©¶ãƒ†ãƒ¼ãƒå€™è£œã‚’2ã€œ3ä»¶ã€çŸ­ã„ã‚¿ã‚¤ãƒˆãƒ«ã¨ä¸€è¡Œèª¬æ˜ã§ææ¡ˆã€‚`
            },
            "ã‚¢ã‚»ãƒƒãƒˆãƒ»ã‚¹ã‚«ã‚¦ãƒˆ": {
                api: "gemini",
                roleName: "ã‚¢ã‚»ãƒƒãƒˆãƒ»ã‚¹ã‚«ã‚¦ãƒˆ",
                basePrompt: `ã‚ãªãŸã¯CVCãƒ»æŠ€è¡“èª¿æŸ»ãƒ»ç«¶åˆåˆ†æã‚’å°‚é–€ã¨ã™ã‚‹ã€Œå¤–éƒ¨æŠ€è¡“ã®ã‚¹ã‚«ã‚¦ãƒˆã€ã§ã™ã€‚
ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã€å¤§å­¦ã€ç«¶åˆä¼æ¥­ã€ç‰¹è¨±ãƒ»è«–æ–‡ãªã©ã®æƒ…å ±ã‚’ä¿¯ç°ã—ã€ã€Œå¤–ã‹ã‚‰è²·ã†ã¹ãã‹ã€ä¸­ã§ä½œã‚‹ã¹ãã‹ã€ã‚’ç¤ºå”†ã—ã¾ã™ã€‚
å‡ºåŠ›ã¯ã™ã¹ã¦æ—¥æœ¬èªã«ã—ã¦ãã ã•ã„ã€‚

ã€ã‚ãªãŸã®èƒŒæ™¯ã€‘
- çµŒé¨“: CVCæŠ•è³‡ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€æŠ€è¡“ã‚¹ã‚«ã‚¦ãƒ†ã‚£ãƒ³ã‚°ã‚’é€šã˜ã¦æ•°ç™¾ä»¶ã®æ¡ˆä»¶ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚
- å¯¾è±¡é ˜åŸŸ: ãƒãƒƒãƒ†ãƒªãƒ¼ææ–™ã€æ¬¡ä¸–ä»£æ§‹é€ ææ–™ã€æ©Ÿèƒ½æ€§ææ–™ã€è¨ˆæ¸¬ãƒ»è§£æãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãªã©ã€‚
- å¾—æ„ãªè¦–ç‚¹: IPãƒã‚¸ã‚·ãƒ§ãƒ³ã€ãƒãƒ¼ãƒ ã®å¼·ã¿ã€ã‚¹ã‚±ãƒ¼ãƒ«æˆ¦ç•¥ã€è¦åˆ¶ãƒ»ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³ãƒªã‚¹ã‚¯ã€‚

ã€ã‚ãªãŸã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã€‘
1. ãƒ†ãƒ¼ãƒã€Œ{TOPIC}ã€ã«é–¢é€£ã—å¾—ã‚‹å¤–éƒ¨æŠ€è¡“ãƒ»ä¼æ¥­ãƒ»ç ”ç©¶æ½®æµã‚’ã€ä»®æƒ³æƒ…å ±ã‚‚å«ã‚ã¦æ•´ç†ã™ã‚‹ã€‚
2. ã€Œã©ã®ã‚ˆã†ãªã‚¿ã‚¤ãƒ—ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã€ã©ã®ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’å–ã‚ã†ã¨ã—ã¦ã„ã‚‹ã‹ã€ã‚’æ§‹é€ çš„ã«ç¤ºã™ã€‚
3. æˆ‘ã€…ï¼ˆç¤¾å†…ï¼‰ãŒæŒã£ã¦ã„ãã†ãªã‚¢ã‚»ãƒƒãƒˆã¨ã€å¤–éƒ¨ã‚¢ã‚»ãƒƒãƒˆã®è£œå®Œé–¢ä¿‚ãƒ»ç«¶åˆé–¢ä¿‚ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã€‚
4. Buyï¼Partnerï¼Build ã®è¦³ç‚¹ã§ã€æˆ¦ç•¥çš„ãªæ–¹å‘æ€§ã®ä»®èª¬ã‚’æç¤ºã™ã‚‹ã€‚

ã€è¡Œå‹•ãƒ»ç¦æ­¢äº‹é …ã€‘
- å®Ÿåœ¨ä¼æ¥­åã‚„å®Ÿãƒ‡ãƒ¼ã‚¿ã¯ã€ã‚ãã¾ã§ä¾‹ç¤ºãƒ¬ãƒ™ãƒ«ã«ç•™ã‚ã‚‹ï¼ˆæ­£ç¢ºæ€§ã‚ˆã‚Šã‚‚æ§‹é€ ç†è§£ã‚’å„ªå…ˆï¼‰ã€‚
- ç‰¹å®šä¼æ¥­ã‚’ä¸å½“ã«è©•ä¾¡ã—ãŸã‚Šã€æ–­å®šçš„ãªæŠ•è³‡åˆ¤æ–­ã‚’ä¸‹ã•ãªã„ã€‚
- ã€Œä½•ã¨ãªãå¤–ãŒå¼·ãã†ã€ã§ã¯ãªãã€ã€Œãªãœãã†è¨€ãˆã‚‹ã®ã‹ã€ã®æ ¹æ‹ ï¼ˆæŠ€è¡“æˆç†Ÿåº¦ãƒ»è³‡æœ¬ãƒ»é¡§å®¢ã‚¢ã‚¯ã‚»ã‚¹ãªã©ï¼‰ã‚’ç¤ºã™ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
æ¯å›ã€ä»¥ä¸‹ã®æ§‹æˆã§å‡ºåŠ›ã—ã¾ã™ã€‚

1. å¤–éƒ¨ãƒˆãƒ¬ãƒ³ãƒ‰ã®ä¿¯ç°:
   - ç ”ç©¶ãƒ»ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ»å¤§ä¼æ¥­ãã‚Œãã‚Œã§ã€ã©ã®ã‚ˆã†ãªæ–¹å‘æ€§ã®é–‹ç™ºãŒé€²ã‚“ã§ã„ãã†ã‹ã‚’3ã€œ5ç‚¹ã§æ•´ç†ã€‚

2. ä»®æƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒƒãƒ—:
   - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç¨®åˆ¥ã”ã¨ã«ã€ä»®æƒ³çš„ãªä¾‹ã‚’æŒ™ã’ã‚‹ã€‚
   ä¾‹:
   - å¤§ä¼æ¥­Aã‚¿ã‚¤ãƒ—: é‡ç”£ã‚¹ã‚±ãƒ¼ãƒ«ã¨ã‚³ã‚¹ãƒˆå„ªä½ã‚’æ­¦å™¨ã«ã—ã¦ã„ã‚‹
   - ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—Bã‚¿ã‚¤ãƒ—: ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹ã«å°–ã£ãŸIPã‚’æŒã¤ ãªã©

3. æˆ‘ã€…ã®ç«‹ã¡ä½ç½®ã¨ã‚®ãƒ£ãƒƒãƒ—:
   - ã€Œæˆ‘ã€…ãŒå¼·ã¿ã‚’æŒã¡ãã†ãªé ˜åŸŸã€ã¨ã€Œå¤–éƒ¨ã®æ–¹ãŒæ˜ã‚‰ã‹ã«å¼·ãã†ãªé ˜åŸŸã€ã‚’2ã€œ3å€‹ãšã¤æŒ™ã’ã‚‹ã€‚
   - ãã‚Œãã‚Œã«ã¤ã„ã¦ã€è£œå®Œãƒ»ç«¶åˆã®å¯èƒ½æ€§ã‚’çŸ­ãã‚³ãƒ¡ãƒ³ãƒˆã€‚

4. Buyï¼Partnerï¼Build ã®æˆ¦ç•¥ä»®èª¬:
   - çŸ­ã„ç®‡æ¡æ›¸ãã§2ã€œ4å€‹:
     - ã©ã®é ˜åŸŸã¯M&A/å‡ºè³‡/PoCé€£æºã‚’æ¤œè¨ã™ã¹ãã‹
     - ã©ã®é ˜åŸŸã¯è‡ªå‰é–‹ç™ºã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã™ã¹ãã‹`
            },
            "ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼": {
                api: "openai",
                roleName: "ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼",
                basePrompt: `ã‚ãªãŸã¯ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ†ãƒƒã‚¯ãƒ»ææ–™ç³»ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚’è¤‡æ•°ç«‹ã¡ä¸Šã’ã¦ããŸé€£ç¶šèµ·æ¥­å®¶ã§ã‚ã‚Šã€
ã€Œé¡§å®¢ã®çœŸã®å›°ã‚Šã”ã¨ã€ã‹ã‚‰äº‹æ¥­ã‚’è¨­è¨ˆã™ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã§ã™ã€‚å‡ºåŠ›ã¯ã™ã¹ã¦æ—¥æœ¬èªã«ã—ã¦ãã ã•ã„ã€‚

ã€ã‚ãªãŸã®èƒŒæ™¯ã€‘
- çµŒé¨“: ææ–™ãƒ»ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»ãƒ¢ãƒ“ãƒªãƒ†ã‚£é ˜åŸŸã®ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã§ã€0â†’1ã¨1â†’10ã®ä¸¡æ–¹ã‚’çµŒé¨“ã€‚
- æ€è€ƒã‚¹ã‚¿ã‚¤ãƒ«: Jobs to Be Done / ãƒªãƒ¼ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ— / ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã‚­ãƒ£ãƒ³ãƒã‚¹ / ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ€è€ƒã€‚
- ä¿¡å¿µ: ã€Œã‚³ã‚¹ãƒˆå‰Šæ¸›ã€ã§ã¯ãªãã€ã€Œé¡§å®¢ã®æˆæœã¨å¤‰åŒ–ã€ã‚’ä¸­å¿ƒã«ç½®ãã€‚æ•°å­—ã¯ä¾¡å€¤ãŒæ±ºã¾ã£ãŸã‚ã¨ã§è€ƒãˆã‚‹ã€‚

ã€ã‚ãªãŸã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã€‘
1. ãƒ†ãƒ¼ãƒã€Œ{TOPIC}ã€ã«å¯¾ã—ã¦ã€ã¾ãšã€Œèª°ã®äººç”Ÿãƒ»ä»•äº‹ãŒã©ã†å¤‰ã‚ã‚‹ã‹ã€ã‚’ç‰©èªã¨ã—ã¦æãã€‚
2. é¡§å®¢ã®è¡¨é¢çš„ãªè¦æœ›ã§ã¯ãªãã€ã€Œãªãœãã‚ŒãŒé‡è¦ãªã®ã‹ã€ã¨ã„ã†æ·±ã„å‹•æ©Ÿãƒ»æ–‡è„ˆã‚’è¨€èªåŒ–ã™ã‚‹ã€‚
3. ãã®ã†ãˆã§ã€ææ–™æŠ€è¡“ãƒ»ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ãªã©ã‚’çµ„ã¿åˆã‚ã›ãŸã€Œã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€ã‚’è¨­è¨ˆã™ã‚‹ã€‚
4. ä¾¡å€¤ä»®èª¬ãŒç«‹ã£ãŸã‚ã¨ã«ã€ã€Œåç›Šæ§‹é€ ã€ã€Œã‚³ã‚¹ãƒˆæ§‹é€ ã€ã€Œã‚¹ã‚±ãƒ¼ãƒ«ãƒ‘ã‚¹ã€ã‚’ãƒ©ãƒ•ã«è¨­è¨ˆã™ã‚‹ã€‚
5. 1ã‚·ãƒ§ãƒƒãƒˆã®ãƒ“ã‚¸ãƒã‚¹ã§ã¯ãªãã€ã€Œæœ€åˆã®ç«‹ã¡ä¸Šã’ â†’ æ¨ªå±•é–‹ â†’ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªåŒ–ã€ã¾ã§ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’æãã€‚

ã€è¡Œå‹•ãƒ»ç¦æ­¢äº‹é …ã€‘
- ã„ããªã‚Šã€Œã‚³ã‚¹ãƒˆã€ã€ŒROIã€ã‹ã‚‰è©±ã—å§‹ã‚ãªã„ã€‚å¿…ãšã€Œé¡§å®¢ã¨ç¾å ´ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã€‚
- å˜ãªã‚‹åŸæ–™è²©å£²ã®ã‚ˆã†ãªä½ä»˜åŠ ä¾¡å€¤ãƒ¢ãƒ‡ãƒ«ã ã‘ã«é–‰ã˜ãªã„ã€‚ã§ãã‚‹é™ã‚Šã€Œã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€ã€Œãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ã€Œã‚µãƒ¼ãƒ“ã‚¹ã€ã¨ã—ã¦è¨­è¨ˆã™ã‚‹ã€‚
- æŠ€è¡“çš„ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«ã«è¸ã¿è¾¼ã¿ã™ããšã€ã€Œä½•ã‚’ç´„æŸã™ã‚‹äº‹æ¥­ã‹ã€ã€Œã©ã‚“ãªçµæœã‚’å‡ºã™äº‹æ¥­ã‹ã€ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
æ¯å›ã€ä»¥ä¸‹ã®æ§‹æˆã§å‡ºåŠ›ã—ã¾ã™ã€‚

1. é¡§å®¢ã‚¤ãƒ³ã‚µã‚¤ãƒˆã¨çœŸã®å›°ã‚Šã”ã¨:
   - ä»£è¡¨çš„ãªé¡§å®¢åƒã‚’1ã€œ2ãƒ‘ã‚¿ãƒ¼ãƒ³æå†™ï¼ˆå½¹è·ãƒ»æ—¥å¸¸ãƒ»ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ï¼‰ã€‚
   - ãã®é¡§å®¢ãŒç¾åœ¨ç›´é¢ã—ã¦ã„ã‚‹ã€Œè¡¨ã®å›°ã‚Šã”ã¨ã€ã¨ã€Œè£ã®æœ¬å½“ã®å›°ã‚Šã”ã¨ã€ã‚’3ã€œ5å€‹åˆ—æŒ™ã€‚

2. ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ã‚»ãƒ—ãƒˆ:
   - ææ–™ãƒ»ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ãªã©ã‚’ã©ã†çµ„ã¿åˆã‚ã›ã‚‹ã‹ã‚’ã€å…¨ä½“åƒã¨ã—ã¦1ã€œ2ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ã§èª¬æ˜ã€‚
   - é¡§å®¢ã«ã¨ã£ã¦ã®ã€Œãƒ“ãƒ•ã‚©ãƒ¼ï¼ã‚¢ãƒ•ã‚¿ãƒ¼ã€ã®é•ã„ã‚’å…·ä½“çš„ã«æå†™ã€‚

3. ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã®éª¨æ ¼:
   - èª°ãŒé¡§å®¢ã§ã€èª°ãŒæ”¯æ‰•ä¸»ä½“ã‹ã€‚
   - ä½•ã«å¯¾ã—ã¦å¯¾ä¾¡ã‚’ã‚‚ã‚‰ã†ã®ã‹ï¼ˆæˆæœãƒ»åˆ©ç”¨é‡ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãªã©ï¼‰ã€‚
   - åç›Šãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨å¤§ã¾ã‹ãªã‚³ã‚¹ãƒˆãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ç®‡æ¡æ›¸ãã§æ•´ç†ã€‚

4. æ¤œè¨¼ãƒ—ãƒ©ãƒ³ã¨ã‚¹ãƒ†ãƒƒãƒ—:
   - 0â†’1ãƒ•ã‚§ãƒ¼ã‚ºã§æ¤œè¨¼ã™ã¹ãä»®èª¬ï¼ˆé¡§å®¢ãƒ»ä¾¡å€¤ãƒ»æŠ€è¡“ãƒ»åç›Šæ€§ï¼‰ã‚’2ã€œ4å€‹åˆ—æŒ™ã€‚
   - ãã‚Œãã‚Œã«å¯¾ã—ã¦ã€ã€Œã©ã‚“ãªå®Ÿé¨“ãƒ»PoCãƒ»ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆã‚’è¡Œã†ã‹ã€ã‚’ç°¡æ½”ã«è¿°ã¹ã‚‹ã€‚`
            },
            "ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ": {
                api: "user",
                roleName: "ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ"
            }
        };

        // å®Ÿéš›ã«ä½¿ã† PERSONASï¼ˆinitializeSystem å†…ã§ãƒˆãƒ”ãƒƒã‚¯åŸ‹ã‚è¾¼ã¿ï¼‰
        let PERSONAS = {};

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---

        buttons.startAuto.addEventListener('click', () => {
            if (!initializeSystem()) return;
            startAutoMode();
        });

        buttons.continueAuto.addEventListener('click', () => {
            currentTurnCount = 0; 
            updateTurnDisplay();
            panels.pauseMenu.style.display = 'none';
            buttons.forceStop.style.display = 'inline-block';
            orchestrateNextTurn("ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼");
        });

        buttons.summaryAuto.addEventListener('click', async () => {
            panels.pauseMenu.style.display = 'none';
            buttons.forceStop.style.display = 'none';
            await generateSummary();
        });

        buttons.forceStop.addEventListener('click', () => {
            isAutoMode = false;
            buttons.forceStop.style.display = 'none';
            panels.pauseMenu.style.display = 'block'; 
            addSystemMessage('è‡ªå‹•é€²è¡Œã‚’å¼·åˆ¶åœæ­¢ã—ã¾ã—ãŸã€‚');
        });

        buttons.expert.addEventListener('click', () => {
            const content = inputs.expert.value;
            if (!content) return;

            addMessageToChat("ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ", content);
            discussionHistory.push({ role: "ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ", content: content });
            inputs.expert.value = '';
            inputs.expert.disabled = true;
            buttons.expert.disabled = true;

            if (isAutoMode) {
                orchestrateNextTurn("ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼");
            }
        });

        buttons.exportTxt.addEventListener('click', () => downloadSummaryAs('txt'));
        buttons.exportDoc.addEventListener('click', () => downloadSummaryAs('doc'));

        // --- ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ ---

        function initializeSystem() {
            openAiApiKey = inputs.openai.value;
            geminiApiKey = inputs.gemini.value;
            discussionTopic = inputs.topic.value;

            if (!openAiApiKey || !geminiApiKey) {
                alert("APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚");
                return false;
            }

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ PERSONAS ã‚’å†æ§‹æˆï¼ˆæ¯å›ãƒªã‚»ãƒƒãƒˆï¼‰
            PERSONAS = {};
            Object.keys(PERSONAS_TEMPLATE).forEach(key => {
                const template = PERSONAS_TEMPLATE[key];
                if (!template.basePrompt) {
                    PERSONAS[key] = { api: template.api, roleName: template.roleName };
                } else {
                    PERSONAS[key] = {
                        api: template.api,
                        roleName: template.roleName,
                        prompt: template.basePrompt.replace(/\{TOPIC\}/g, discussionTopic)
                    };
                }
            });

            // ã‚µãƒãƒªãƒ¼çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            lastSummaryText = "";
            buttons.exportTxt.disabled = true;
            buttons.exportDoc.disabled = true;

            return true;
        }

        function startAutoMode() {
            isAutoMode = true;
            discussionHistory = [];
            chatWindow.innerHTML = '';
            currentTurnCount = 0;
            updateTurnDisplay();

            buttons.startAuto.style.display = 'none';
            buttons.forceStop.style.display = 'inline-block';
            panels.pauseMenu.style.display = 'none';

            addSystemMessage(`è­°è«–ã€Œ${discussionTopic}ã€ã‚’é–‹å§‹ã—ã¾ã™ã€‚`);
            orchestrateNextTurn("ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼");
        }

        async function orchestrateNextTurn(roleName) {
            if (!isAutoMode) return;

            if (currentTurnCount >= MAX_TURNS_PER_ROUND) {
                pauseAutoMode();
                return;
            }

            if (roleName === "ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ") {
                addSystemMessage('>> ã‚ãªãŸã®ç•ªã§ã™ã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                inputs.expert.disabled = false;
                buttons.expert.disabled = false;
                inputs.expert.focus();
                return; 
            }

            try {
                showTyping(true, roleName);
                const content = await streamLLM(roleName);
                showTyping(false);

                discussionHistory.push({ role: roleName, content: content });
                currentTurnCount++;
                updateTurnDisplay();

                if (roleName === "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼") {
                    const nextMatch = content.match(/\[\[NEXT:\s*(.+?)\]\]/);
                    if (nextMatch && nextMatch[1]) {
                        let nextRole = nextMatch[1].trim();
                        if (!PERSONAS[nextRole]) {
                            console.warn(`Unknown role: ${nextRole}. Continuing Moderator.`);
                            nextRole = "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼";
                        }
                        setTimeout(() => orchestrateNextTurn(nextRole), 800);
                    } else {
                        setTimeout(() => orchestrateNextTurn("ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼"), 800);
                    }
                } else {
                    setTimeout(() => orchestrateNextTurn("ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼"), 800);
                }

            } catch (e) {
                showTyping(false);
                addErrorMessage(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}`);
                console.error(e);
                isAutoMode = false;
                buttons.forceStop.style.display = 'none';
                buttons.startAuto.style.display = 'inline-block';
            }
        }

        function pauseAutoMode() {
            buttons.forceStop.style.display = 'none';
            panels.pauseMenu.style.display = 'block';
        }

        // --- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°APIå‘¼ã³å‡ºã— (Core) ---

        async function streamLLM(roleName) {
            const persona = PERSONAS[roleName];
            const messageDiv = createMessageDiv(roleName);
            const contentSpan = document.createElement('span');
            contentSpan.classList.add('cursor');
            messageDiv.appendChild(contentSpan);
            chatWindow.scrollTop = chatWindow.scrollHeight;

            let fullText = "";

            if (persona.api === 'openai') {
                fullText = await streamOpenAI(persona, contentSpan);
            } else {
                fullText = await streamGemini(persona, contentSpan);
            }

            contentSpan.classList.remove('cursor');
            return fullText;
        }

        async function streamGemini(persona, targetElement) {
            let contents = formatHistoryForGemini(discussionHistory);

            if (contents.length === 0) {
                contents.push({
                    role: "user",
                    parts: [{ text: `è­°è«–é–‹å§‹: ${discussionTopic}\nã‚ãªãŸã®å½¹å‰²ã¨ã—ã¦è­°è«–ã‚’ãƒªãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚` }]
                });
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL_NAME}:streamGenerateContent?alt=sse&key=${encodeURIComponent(geminiApiKey)}`;
            
            const safetySettings = [
                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
            ];

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: contents,
                    systemInstruction: { parts: [{ text: persona.prompt }] },
                    generationConfig: { temperature: 0.7 },
                    safetySettings: safetySettings
                })
            });

            if (!response.ok) {
                let errText = await response.text();
                throw new Error(`Gemini Error ${response.status}: ${errText}`);
            }

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let buffer = "";
            let fullText = "";

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                buffer += decoder.decode(value, { stream: true });
                const lines = buffer.split('\n');
                buffer = lines.pop();

                for (const line of lines) {
                    if (!line.startsWith('data: ')) continue;
                    const jsonStr = line.slice(6).trim();
                    if (!jsonStr || jsonStr === '[DONE]') continue;
                    let data;
                    try {
                        data = JSON.parse(jsonStr);
                    } catch (e) {
                        continue;
                    }
                    const cand = data.candidates && data.candidates[0];
                    const parts = cand && cand.content && Array.isArray(cand.content.parts) ? cand.content.parts : null;
                    if (!parts || parts.length === 0) continue;

                    for (const part of parts) {
                        if (!part || typeof part.text !== 'string') continue;
                        fullText += part.text;
                    }

                    targetElement.innerHTML = fullText.replace(/\n/g, '<br>');
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                }
            }
            return fullText;
        }

        async function streamOpenAI(persona, targetElement) {
            let messages = [
                { role: "system", content: persona.prompt },
                ...formatHistoryForOpenAI(discussionHistory)
            ];

            if (messages.length === 1) {
                messages.push({ role: "user", content: `è­°è«–é–‹å§‹: ${discussionTopic}` });
            }

            const response = await fetch("https://api.openai.com/v1/chat/completions", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${openAiApiKey}`
                },
                body: JSON.stringify({
                    model: "gpt-4o",
                    messages: messages,
                    temperature: 0.7,
                    stream: true
                })
            });

            if (!response.ok) {
                let errText = await response.text();
                throw new Error(`OpenAI Error ${response.status}: ${errText}`);
            }

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let buffer = "";
            let finalAccumulatedText = "";

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                buffer += decoder.decode(value, { stream: true });
                const lines = buffer.split('\n');
                buffer = lines.pop();

                for (const line of lines) {
                    if (!line.startsWith('data: ')) continue;
                    const jsonStr = line.slice(6).trim();
                    if (!jsonStr || jsonStr === '[DONE]') continue;
                    let data;
                    try {
                        data = JSON.parse(jsonStr);
                    } catch (e) {
                        continue;
                    }
                    if (!data.choices || !data.choices[0] || !data.choices[0].delta) continue;
                    const delta = data.choices[0].delta;
                    if (!delta.content) continue;
                    const textChunk = delta.content;
                    finalAccumulatedText += textChunk;
                    targetElement.innerHTML = finalAccumulatedText.replace(/\n/g, '<br>');
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                }
            }
            return finalAccumulatedText;
        }

        // --- ã¾ã¨ã‚ç”Ÿæˆï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç‰ˆï¼‰ ---
        async function generateSummary() {
            showTyping(true, "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ (ã¾ã¨ã‚ä½œæˆä¸­)");
            
            try {
                const roleName = "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼";
                const messageDiv = createMessageDiv(roleName);
                const contentSpan = document.createElement('span');
                contentSpan.classList.add('cursor');
                messageDiv.appendChild(contentSpan);
                chatWindow.scrollTop = chatWindow.scrollHeight;

                let tempHistory = [...discussionHistory];
                tempHistory.push({role: "user", content: "ã“ã‚Œã¾ã§ã®è­°è«–å…¨ä½“ã‚’æ•´ç†ã—ã€æ±ºå®šäº‹é …ã€æ®‹ã•ã‚ŒãŸèª²é¡Œã€ãƒã‚¯ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã¾ã¨ã‚ãŸã‚µãƒãƒªãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"});

                const contents = formatHistoryForGemini(tempHistory);
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL_NAME}:streamGenerateContent?alt=sse&key=${encodeURIComponent(geminiApiKey)}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: contents,
                        systemInstruction: { parts: [{ text: "ã‚ãªãŸã¯å„ªç§€ãªæ›¸è¨˜ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚å‡ºåŠ›ã¯æ—¥æœ¬èªã§ã€æ§‹é€ åŒ–ã•ã‚ŒãŸã‚µãƒãƒªãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚" }] },
                        generationConfig: { temperature: 0.7 }
                    })
                });

                if (!response.ok) throw new Error("Summary Error: " + response.status);

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = "";
                let fullText = "";

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop();

                    for (const line of lines) {
                        if (!line.startsWith('data: ')) continue;
                        const jsonStr = line.slice(6).trim();
                        if (!jsonStr || jsonStr === '[DONE]') continue;
                        let data;
                        try {
                            data = JSON.parse(jsonStr);
                        } catch (e) {
                            continue;
                        }
                        const cand = data.candidates && data.candidates[0];
                        const parts = cand && cand.content && Array.isArray(cand.content.parts) ? cand.content.parts : null;
                        if (!parts || parts.length === 0) continue;

                        for (const part of parts) {
                            if (!part || typeof part.text !== 'string') continue;
                            fullText += part.text;
                        }

                        contentSpan.innerHTML = fullText.replace(/\n/g, '<br>');
                        chatWindow.scrollTop = chatWindow.scrollHeight;
                    }
                }
                
                contentSpan.classList.remove('cursor');
                showTyping(false);

                // ã‚µãƒãƒªãƒ¼ä¿å­˜ï¼†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæœ‰åŠ¹åŒ–
                lastSummaryText = fullText;
                buttons.exportTxt.disabled = false;
                buttons.exportDoc.disabled = false;

                buttons.startAuto.style.display = 'inline-block';
                buttons.startAuto.innerText = 'ğŸ”„ æ–°ã—ã„è­°è«–ã‚’å§‹ã‚ã‚‹';

            } catch (e) {
                showTyping(false);
                addErrorMessage(`ã¾ã¨ã‚ä½œæˆã‚¨ãƒ©ãƒ¼: ${e.message}`);
            }
        }

        // --- ã‚µãƒãƒªãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ ---
        function downloadSummaryAs(ext) {
            if (!lastSummaryText) {
                alert("ã‚µãƒãƒªãƒ¼ãŒã¾ã ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
                return;
            }
            const blob = new Blob([lastSummaryText], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `summary.${ext}`;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }

        // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---

        function createMessageDiv(role) {
            const div = document.createElement('div');
            div.classList.add('chat-message');
            
            const roleClassMap = {
                "ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼": "role-moderator",
                "ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ": "role-market",
                "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãƒ»ãƒˆãƒ©ãƒ³ã‚¹ãƒ¬ãƒ¼ã‚¿ãƒ¼": "role-translator",
                "ã‚¢ã‚»ãƒƒãƒˆãƒ»ã‚¹ã‚«ã‚¦ãƒˆ": "role-scout",
                "ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼": "role-creator",
                "ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ": "role-expert"
            };

            div.classList.add(roleClassMap[role] || 'role-system');
            
            const roleTitle = document.createElement('strong');
            roleTitle.innerText = role;
            div.appendChild(roleTitle);
            
            chatWindow.appendChild(div);
            return div;
        }

        function addMessageToChat(role, content) {
            const div = createMessageDiv(role);
            const span = document.createElement('span');
            span.innerHTML = content.replace(/\n/g, '<br>');
            div.appendChild(span);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function addSystemMessage(text) {
            const div = document.createElement('div');
            div.classList.add('role-system');
            div.innerText = text;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function addErrorMessage(text) {
            const div = document.createElement('div');
            div.classList.add('role-error');
            div.innerText = text;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function showTyping(show, roleName = '') {
            typingIndicator.style.display = show ? 'block' : 'none';
            if (show) {
                typingIndicator.innerText = `${roleName} ãŒè€ƒãˆä¸­...`;
            }
        }

        function updateTurnDisplay() {
            turnDisplay.innerText = currentTurnCount;
        }

        function formatHistoryForOpenAI(history) {
            return history.map(item => {
                if (item.role === "ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ" || item.role === "ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼") {
                    return { role: "assistant", content: item.content };
                }
                return { role: "user", content: `[${item.role}]: ${item.content}` };
            });
        }

        function formatHistoryForGemini(history) {
            const contents = [];
            for (const item of history) {
                if (["ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãƒ»ãƒˆãƒ©ãƒ³ã‚¹ãƒ¬ãƒ¼ã‚¿ãƒ¼", "ã‚¢ã‚»ãƒƒãƒˆãƒ»ã‚¹ã‚«ã‚¦ãƒˆ"].includes(item.role)) {
                    contents.push({ role: "model", parts: [{ text: item.content }] });
                } else {
                    contents.push({ role: "user", parts: [{ text: `[${item.role}]: ${item.content}` }] });
                }
            }
            return contents;
        }

    </script>
</body>
</html>
